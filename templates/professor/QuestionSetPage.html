{% extends "professor/base.html" %}
{% load static %}
{% load i18n %}
{% block styles %}
  <style>
  .question_dt_right_btn{
            float: right;
        }
  .dataTables_filter svg{
    z-index: 100;
    transform: translateX(-5px);
    }
  .dataTables_filter input{
      transform: translateX(20px);

  }
  .status-text{
      cursor: auto;
      text-decoration: none;
  }


  </style>
{% endblock styles %}
{% block content %}


    <div class="bg-white pt-2">

      <h1 class="page-heading">{% trans "QuestionSet Lists" %}</h1>

    <div class="table-responsive questionset_table" id="questionset_table" style="border: none;">
            <table class="table pt-2" cellspacing="0" id="questionset_list_table">
                <thead class="">
                <tr class="tableTitleRow">
                    <th>
                        <input type="checkbox" class="CheckAll">
                    </th>
                    <th>{% trans "S. No." %}</th>
                    <th>{% trans "Unique Code" %}</th>
                    <th>{% trans "Description" %}</th>
                    <th>{% trans "Difficulty level" %}</th>
                    <th>{% trans "SubCategory" %}</th>
                    <th>{% trans "No. of Questions" %}</th>
                    <th>{% trans "Status" %}</th>
                    <th>{% trans "Details" %}</th>
                    <th>{% trans "Actions" %}</th>
                </tr>

                </thead>
                <tbody>

                {% for object in object_list %}
                    <tr>
                   <td><input type="checkbox" class="questionCheckbox" value="{{ object.id }}">
                   </td>
                        <td> {{ forloop.counter }}</td>
                        <td> {{ object.unique_code }}</td>
                        <td> {{ object.description|truncatechars:40 }}</td>
                        <td> {{ object.difficulty_level }}</td>
                        <td>{{ object.subcategory_code.name }}</td>
                        <td>{{ object.questions.count }}</td>

                        {%  if object.is_active  %}
                         <td>  <span class="btn btn-sm btn-success"><a class="text-white status-text">Active</a></span></td>
                         {% else %}
                         <td> <span class="btn btn-sm btn-secondary"><a class="text-white status-text">Inactive</a></span> </td>
                       {% endif  %}

                        <td>
                            <a class="btn btn-sm btn-secondary" id="{{ object.id }}" href="{% url 'professor:question_detail' object.id %}">{% trans "Detail" %}</a>
                        </td>
                        <td> <a title="{% trans 'Update QuestionSet' %}" class="btn btn-sm btn-warning rounded-circle editQuestionset"  id="editQuestion_{{ object.pk }}"><i class ="text-white fa fa-pen" data-bs-toggle="modal" data-bs-target="#add_question_modal"> </i></a>
                            <a title="{% trans 'Delete QuestionSet' %}" class="btn btn-sm btn-danger rounded-circle deleteQuestionset confirm-delete ml-1" id="{{ object.id }}"><i class=" fa fa-trash"></i></a>
                        </td>

                </tr>
                {% endfor %}

                </tbody>
            </table>
            <span class="checkboxCheckedLength"></span>
        </div>




    <div id="add_question_modal" class="modal fade" style="height: -webkit-fill-available;">
        <div class="modal-dialog modal-xl">
            <div class="modal-content" style="height: -webkit-fill-available; overflow: auto; overflow-x: hidden;">
                <div class="modal-header">
                    <h3 class="modal-title text-center" id="create_survey_modal_title" >
                        {% trans "QuestionSet Registration" %}
                    </h3>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                        <i class="ti-close"></i>
                    </button>
                </div>
                <div class="modal-body" id="QuestionForm">
                    <div class="card">

                        <div class="card-body">
                            <div class="question_form_div">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


{% endblock %}


{% block scripts %}

  <script>

    $(document).ready(function () {

      $(".editQuestionset").click(function () {
        let object_id = $(this).attr('id').split("_")[1]
        console.log("object_ID", object_id)
        $('.question_form_div').append('<div class="se-pre-con-ajax"></div>');
        $.ajax({
          type: "GET",
          url: "{% url 'professor:question_update' pk='000123' %}".replace('000123', object_id),  // URL to your view that serves new info
          success: function (data) {
            $(".question_form_div").html(data);
          },
          complete: function () {
            $(".se-pre-con-ajax").fadeOut("fast");
            $("#create_survey_modal_title").html("")
            $("#create_survey_modal_title").html("Update Question")


          }
        });

      })


      $(".register_btn").click(function () {
        // $('#QuestionRegistrationForm').empty();
  //      $('#QuestionRegistrationForm input').not(':button, :submit, :reset, :hidden').val('');
        $("#create_survey_modal_title").html("")
        $("#create_survey_modal_title").html("Question Registration")


      })


    })

    function add_question() {


      $('.question_form_div').append('<div class="se-pre-con-ajax"></div>');
      $.ajax({
        type: "GET",
        url: "{% url 'professor:question_create_ajax' %}",  // URL to your view that serves new info
        success: function (data) {
          $(".question_form_div").html(data);
          $("#create_survey_modal_title").html("")
          $("#create_survey_modal_title").html("Question Registration")
        },
        complete: function () {
          $(".se-pre-con-ajax").fadeOut("fast");
          $(".question_form_error_div").hide();


        }
      });
    }

  </script>

<script>

function delete_multi(){
   console.log("Clicked")
    if( !confirm("{% trans 'Are you sure you want to delete selected QuestionSet?' %}") ){
        return false;
      }

   let seleced_questionset = []
   $.each($('#questionset_list_table input[type="checkbox"]:checked').not('.CheckAll'), function (index) {
     seleced_questionset.push($(this).val())
   });
   $.ajax({
     type: "POST",
     url: "{% url 'professor:delete_multiple_questionset' %}",
     data: {
       'csrfmiddlewaretoken': '{{ csrf_token }}',
       'questionset_ids': seleced_questionset,
     },
     success: function (data) {
       location.reload();
     },

   });
 }







 $('#questionset_list_table').DataTable({
        dom: 'lfBtp',
        responsive: true,
        pagingType: "full_numbers",
        language: { search: '_INPUT_',
                    searchPlaceholder: "{% trans 'Search' %}...",
                    lengthMenu: "&nbsp; _MENU_" },


        buttons: [

            {
                text: "<i class='fa fa-plus mr-2'></i> {% trans 'Register' %}",
                action: add_question(),
                className: "question_dt_right_btn btn-chinju-orange active btn btn-sm register_btn",
            },
            {
                text: "<i class='fa fa-trash  multiple-delete'></i>",
                className: "question_dt_right_btn ",
            },
        ],





        oLanguage: {
            oPaginate: {
                sFirst: '<i class="fas fa-angle-double-left"></i>',
                sNext: '<i class="fas fa-angle-right"></i>',
                sPrevious: '<i class="fas fa-angle-left"></i>',
                sLast: '<i class="fas fa-angle-double-right"></i>',
            }

        },
        initComplete: function() {
             $('.dataTables_filter').addClass('question_dt_right_btn');
             $('.dataTables_length').addClass('question_dt_right_btn');
           //  $('.dataTables_filter input').removeClass('form-control-sm');
             $('.dataTables_filter input').after(`<span class="fa fa-search search-input-icon pr-5"></span>`);
             $('.dataTables_length select').removeClass('custom-select-sm');
             $('.dt-buttons button').addClass('btn-gray text-white');
             $('.dt-buttons').removeClass('btn-group');
             $('.question_dt_right_btn').css('margin-left', '10px');
             $('.register_btn').css('margin-right', '-22px');
              $('.register_btn').attr("data-bs-toggle", "modal");
              $('.register_btn').attr("data-bs-target", "#add_question_modal");
            //   $('.editQuestion').attr("data-bs-toggle", "modal");
           //   $('.editQuestion').attr("data-bs-target", "#add_question_modal");


            $('.multiple-delete').parent().parent().attr({'class':'btn btn-sm btn-danger rounded-circle question_dt_right_btn  text-white mr-2 deleteCheckedQuestions',
                                                'type': 'submit',
                                              //  'onclick': `return confirm("{% trans 'Are you sure you want to delete selected QuestionSet?' %}")`,
                                                'disabled': 'true',
                                                'title': '{% trans "Delete Selected QuestionSet" %}'})

              $('.multiple-delete').parent().parent().attr('onclick',"delete_multi()")



            $('.dataTables_paginate').addClass('my-4');






             $(".CheckAll").closest("th").removeClass("sorting_asc");
        },
        stateSave: false,
        responsive: true,
        processing: true,

        fnRowCallback: function(nRow, aData, iDisplayIndex, iDisplayIndexFull) {

          var index = iDisplayIndexFull + 1;
          $("td:eq(1)", nRow).html(index);
          return nRow;
        },
        columnDefs: [
            { orderable: false, targets: [0,7,8] }
        ],
    });


</script>
  <script>

    $(document).on('click', '.confirm-delete', function () {
        ans = confirm('Are you sure you want to delete this QuestionSet? ');
        if (ans == true) {
            $.ajax({
                url: "{% url 'professor:questionset_delete' pk='000123' %}".replace('000123', this.id),
                method: 'post',
                data: {
                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                },
                success: function () {
                    location.reload();
                }
            })
        } else {
            return false;
        }
    });


     $('.CheckAll').on('click', function () {
        $('#questionset_list_table input:checkbox').not(this).prop('checked', this.checked);
        checkboxChangeEvent()
    });
    $('#questionset_list_table').on('click', '.questionCheckbox', function () {
          if ($('.questionCheckbox').length === $('.questionCheckbox:checked').length) {
              $('.CheckAll').prop('checked', 'checked');
          } else {
              $('.CheckAll').prop('checked', false);
          }
          checkboxChangeEvent()
      });

    function checkboxChangeEvent() {
      console.log("ALL SELECTEDS")
        let checkBoxlength = $('#questionset_list_table input[type="checkbox"]:checked').not('.CheckAll').length
        if (checkBoxlength > 0) {
            $('.checkboxCheckedLength').text(checkBoxlength + ' of ' + $('.questionCheckbox').length + ' selected')
            $('.deleteCheckedQuestions').removeAttr('disabled')
        } else {
            $('.checkboxCheckedLength').text('')
            $('.deleteCheckedQuestions').prop('disabled', 'disabled')
        }
    }






  </script>
{% endblock scripts %}