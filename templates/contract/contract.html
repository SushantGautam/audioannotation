{% load i18n %}
{% load static %}

{% block styles %}
    <link rel="stylesheet" href="{% static 'css/progress.css' %}">
    <style>

.multi_step_progress #msprogress fieldset {
  border: 0;
  padding: 20px 105px 0;
  position: relative;
  width: 100%;
  left: 0;
  right: 0;
}
.multi_step_progress #msprogress fieldset:not(:first-of-type) {
  display: none;
}
.multi_step_progress #msprogress fieldset h3 {
  font: 500 18px/35px "Roboto", sans-serif;
  color: #3f4553;
}
.multi_step_progress #msprogress fieldset h6 {
  font: 400 15px/28px "Roboto", sans-serif;
  color: #5f6771;
  padding-bottom: 30px;
}
.multi_step_progress #msprogress fieldset .intl-tel-input {
  display: block;
  background: transparent;
  border: 0;
  box-shadow: none;
  outline: none;
}
.multi_step_progress #msprogress fieldset .intl-tel-input .flag-container .selected-flag {
  padding: 0 20px;
  background: transparent;
  border: 0;
  box-shadow: none;
  outline: none;
  width: 65px;
}
.multi_step_progress #msprogress fieldset .intl-tel-input .flag-container .selected-flag .iti-arrow {
  border: 0;
}
.multi_step_progress #msprogress fieldset .intl-tel-input .flag-container .selected-flag .iti-arrow:after {
  content: "";
  position: absolute;
  top: 0;
  right: 0;
  font: normal normal normal 24px/7px Ionicons;
  color: #5f6771;
}
.multi_step_progress #msprogress fieldset #phone {
  padding-left: 80px;
}
.multi_step_progress #msprogress fieldset .form-group {
  padding: 0 10px;
}
.multi_step_progress #msprogress fieldset .fg_2,
.multi_step_progress #msprogress fieldset .fg_3 {
  padding-top: 10px;
  display: block;
  overflow: hidden;
}
.multi_step_progress #msprogress fieldset .fg_3 {
  padding-bottom: 70px;
}
.multi_step_progress #msprogress fieldset .form-control,
.multi_step_progress #msprogress fieldset .product_select {
  border-radius: 3px;
  border: 1px solid #d8e1e7;
  padding: 0 20px;
  height: auto;
  font: 400 15px/48px "Roboto", sans-serif;
  color: #5f6771;
  box-shadow: none;
  outline: none;
  width: 100%;
}
.multi_step_progress #msprogress fieldset .form-control.placeholder,
.multi_step_progress #msprogress fieldset .product_select.placeholder {
  color: #5f6771;
}
.multi_step_progress #msprogress fieldset .form-control:-moz-placeholder,
.multi_step_progress #msprogress fieldset .product_select:-moz-placeholder {
  color: #5f6771;
}
.multi_step_progress #msprogress fieldset .form-control::-moz-placeholder,
.multi_step_progress #msprogress fieldset .product_select::-moz-placeholder {
  color: #5f6771;
}
.multi_step_progress #msprogress fieldset .form-control::-webkit-input-placeholder,
.multi_step_progress #msprogress fieldset .product_select::-webkit-input-placeholder {
  color: #5f6771;
}
.multi_step_progress #msprogress fieldset .form-control:hover, .multi_step_progress #msprogress fieldset .form-control:focus,
.multi_step_progress #msprogress fieldset .product_select:hover,
.multi_step_progress #msprogress fieldset .product_select:focus {
  border-color: #5cb85c;
}
.multi_step_progress #msprogress fieldset .form-control:focus.placeholder,
.multi_step_progress #msprogress fieldset .product_select:focus.placeholder {
  color: transparent;
}
.multi_step_progress #msprogress fieldset .form-control:focus:-moz-placeholder,
.multi_step_progress #msprogress fieldset .product_select:focus:-moz-placeholder {
  color: transparent;
}
.multi_step_progress #msprogress fieldset .form-control:focus::-moz-placeholder,
.multi_step_progress #msprogress fieldset .product_select:focus::-moz-placeholder {
  color: transparent;
}
.multi_step_progress #msprogress fieldset .form-control:focus::-webkit-input-placeholder,
.multi_step_progress #msprogress fieldset .product_select:focus::-webkit-input-placeholder {
  color: transparent;
}
.multi_step_progress #msprogress fieldset .product_select:after {
  display: none;
}
.multi_step_progress #msprogress fieldset .product_select:before {
  content: "";
  position: absolute;
  top: 0;
  right: 20px;
  font: normal normal normal 24px/48px Ionicons;
  color: #5f6771;
}
.multi_step_progress #msprogress fieldset .product_select .list {
  width: 100%;
}
.multi_step_progress #msprogress fieldset .done_text {
  padding-top: 40px;
}
.don_icon_number {
    height: 30px;
    width: 30px;
    line-height: 30px;
    font-size: 20px;
    background: #3f4553;
    display: inline-block;
    border-radius: 50%;
    color: #ffffff;
}
.don_icon {
  height: 36px;
  width: 36px;
  line-height: 36px;
  font-size: 22px;
  margin-bottom: 10px;
  background: #5cb85c;
  display: inline-block;
  border-radius: 50%;
  color: #ffffff;
  text-align: center;
}
.multi_step_progress #msprogress fieldset .done_text h6 {
  line-height: 23px;
}
.multi_step_progress #msprogress fieldset .code_group {
  margin-bottom: 60px;
}
.multi_step_progress #msprogress fieldset .code_group .form-control {
  border: 0;
  border-bottom: 1px solid #a1a7ac;
  border-radius: 0;
  display: inline-block;
  width: 30px;
  font-size: 30px;
  color: #5f6771;
  padding: 0;
  margin-right: 7px;
  text-align: center;
  line-height: 1;
}
.multi_step_progress #msprogress fieldset .passport {
  margin-top: -10px;
  padding-bottom: 30px;
  position: relative;
}
.don_icon {
  height: 36px;
  width: 36px;
  line-height: 36px;
  font-size: 22px;
  /* position: absolute;
  top: 4px;
  right: 0; */
  background: #5cb85c;
  display: inline-block;
  border-radius: 50%;
  color: #ffffff;
  text-align: center;
}
.multi_step_progress #msprogress fieldset .passport h4 {
  font: 500 15px/23px "Roboto", sans-serif;
  color: #5f6771;
  padding: 0;
}
.multi_step_progress #msprogress fieldset .input-group {
  padding-bottom: 40px;
}
.multi_step_progress #msprogress fieldset .input-group .custom-file {
  width: 100%;
  height: auto;
}
.multi_step_progress #msprogress fieldset .input-group .custom-file .custom-file-label {
  width: 168px;
  border-radius: 5px;
  cursor: pointer;
  font: 700 14px/40px "Roboto", sans-serif;
  border: 1px solid #99a2a8;
  text-align: center;
  transition: all 300ms linear 0s;
  color: #5f6771;
}
.multi_step_progress #msprogress fieldset .input-group .custom-file .custom-file-label i {
  font-size: 20px;
  padding-right: 10px;
}
.multi_step_progress #msprogress fieldset .input-group .custom-file .custom-file-label:hover, .multi_step_progress #msprogress fieldset .input-group .custom-file .custom-file-label:focus {
  background: #5cb85c;
  border-color: #5cb85c;
  color: #fff;
}
.multi_step_progress #msprogress fieldset .input-group .custom-file input {
  display: none;
}
.multi_step_progress #msprogress fieldset .file_added {
  text-align: left;
  padding-left: 190px;
  padding-bottom: 60px;
}
.multi_step_progress #msprogress fieldset .file_added li {
  font: 400 15px/28px "Roboto", sans-serif;
  color: #5f6771;
}
.multi_step_progress #msprogress fieldset .file_added li a {
  color: #5cb85c;
  font-weight: 500;
  display: inline-block;
  position: relative;
  padding-left: 15px;
}
.multi_step_progress #msprogress fieldset .file_added li a i {
  font-size: 22px;
  padding-right: 8px;
  position: absolute;
  left: 0;
  transform: rotate(20deg);
}

/* checkbox style */
input[type=checkbox] + label {
  display: block;
  margin: 0.2em;
  cursor: pointer;
  padding: 0.2em;
}

input[type=checkbox] {
  display: none;
}

input[type=checkbox] + label:before {
  content: "\2714";
  border: 0.1em solid #000;
  border-radius: 0.2em;
  display: inline-block;
  width: 1.3em;
  height: 1.3em;
  /* padding-left: 0.2em; */
  padding-bottom: 0.3em;
  margin-right: 0.2em;
  vertical-align: bottom;
  color: transparent;
  transition: .2s;
}

input[type=checkbox] + label:active:before {
  transform: scale(0);
}

input[type=checkbox]:checked + label:before {
  background-color: MediumSeaGreen;
  border-color: MediumSeaGreen;
  color: #fff;
}

input[type=checkbox]:disabled + label:before {
  transform: scale(1);
  border-color: #aaa;
}

input[type=checkbox]:checked:disabled + label:before {
  transform: scale(1);
  background-color: #bfb;
  border-color: #bfb;
}
    </style>
{% endblock %}

<!-- Multi step progress -->
<section class="multi_step_progress three-step">
    <div id="msprogress">
        <ul id="progressbar">
            <li class="{% if has_contract %}active{% endif %}">
                <div class="h6">{% trans 'Contract Available' %}</div>
            </li>
            <li class="{% if has_contract_submitted or has_contract_approved %}active{% endif %}">
                <div class="h6">{% trans 'Contract Signed' %}</div>
            </li>
            <li class="{% if has_contract_approved %}active{% endif %}">
                <div class="h6">{% trans 'Contract Approved' %}</div>
            </li>
        </ul>

        <div class="title mt-5">
            {% if not has_contract %}
                <h2>{% trans 'Contract is not available. Please contact Admin' %}</h2>
            {% elif has_contract_submitted and not has_contract_approved %}
                <h2>{% trans 'Your contract is waiting for approval. Please be patient.' %}</h2>
            {% elif not has_contract_submitted and not has_contract_approved %}
            <fieldset>
                <h2>
                    <span class="don_icon_number h5"><i class="fa-solid fa-1"></i></span>
                    {% trans 'Please Download and fill the contract below.' %}
                </h2>
                <div class="contract-container mt-4">
                    <div><span style="font-weight:bold">Title:</span>  {{ contract.title }}</div>
                    {% if contract.description %}
                        <div><span style="font-weight:bold">Description:</span>  {{ contract.description }}</div>
                    {% endif %}
                    <div class="mt-4">
                        {% if contract.upload_file.url %}
                            <p>
                                <i class="fa-solid fa-paperclip"></i>
                                {{ contract.get_upload_file_name }}
                                <a href="{{ contract.upload_file.url }}" class="btn btn-info ms-4" target="_blank">
                                    <i class="fa-solid fa-cloud-arrow-down"></i> {% trans 'Download Contract' %}
                                </a>
                            </p>
                        {% else %}
                            {% trans 'No Attachment Available' %}
                        {% endif %}
                    </div>
                    <h2 class="mt-5">
                        <span class="don_icon_number h5"><i class="fa-solid fa-2"></i></span>
                        {% trans 'Please Upload the signed Contract and accept the terms' %}
                    </h2>
                    <div class="form-container mt-2">
                        <form name="contract-submission" method="post" enctype="multipart/form-data">
                            {% csrf_token %}
                            <div>
                                <div class="input-group"> 
                                    <div class="custom-file">
                                      <input type="file" class="custom-file-input" id="file-upload-input" name="contract-file" required>
                                      <label class="custom-file-label" for="file-upload-input"><i class="fa-solid fa-upload"></i>Choose file</label>
                                      <div class="file-select-name mt-2">No file chosen...</div>
                                    </div>
                                  </div>
                                <input type="hidden" name="contract-id" value="{{ contract.id }}">
                            </div>
                            <div class="mb-4 h5">
                                <input type="checkbox" id="agree-terms" onchange="toggleDisabledFormButton(this)">
                                <label for="agree-terms">{% trans 'I agree to all terms and conditions' %}</label>
                            </div>
                            <button type="submit" class="btn btn-lg btn-success" disabled id="submit-btn">{% trans 'Submit' %}</button>
                        </form>
                    </div>
        
                </div>
              </fieldset>  
            {% elif has_contract_approved %}
                <h2 class="mt-5">
                    {% trans 'Congratulation. Your contract is approved.' %}
                    <span class="don_icon"><i class="fa-solid fa-check"></i></span>
                </h2>
            {% endif %}
        </div>
    </div>
</section>
<!-- End Multi step progress -->

<script>
    function toggleDisabledFormButton(elem) {
        var btnelement = document.getElementById('submit-btn');
        btnelement.disabled = !btnelement.disabled;
    }

    let fileInput = document.getElementById("file-upload-input");
    fileInput.onchange = function() {
        let filename = fileInput.files[0].name;
        let selectName = document.getElementsByClassName("file-select-name")[0];
        selectName.innerText = filename;
    }

    // when submit button is clicked, check if file is uploaded
    document.getElementById("submit-btn").addEventListener("click", function(event) {
        if (fileInput.files.length == 0) {
            event.preventDefault();
            alert("{% trans 'Please upload signed contract file' %}");
        }
    });

</script>