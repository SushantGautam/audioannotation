{% load static %}
{% load i18n %}

<form method="post" action="{% url 'speaker:edit_profile' pk=user.speaker.id %}" method="post">
    {% csrf_token %}
    {% if form.errors %}
        {% for field in form %}
            {% for error in field.errors %}
                <div class="alert alert-danger">
                    <strong>{{ error|escape }}</strong>
                </div>
            {% endfor %}
        {% endfor %}
    {% endif %}
    <section class="profile-edit-section w-60">


        <section id="basic-section" class="d-flex">
            <div class="text-center justify-content-start">
                <img src="/static/img/user.png" class="rounded-circle" style="width: 10rem;height: 10rem;" alt="">
            </div>

            <div>
                <label for="id_first_name">First name:</label>
                <input type="text" name="first_name" value="{{ userForm.first_name.initial }}"
                       maxlength="150" id="id_first_name">
                <label for="id_last_name">Last name:</label>
                <input type="text" name="last_name" value="{{ userForm.last_name.initial }}"
                       maxlength="150" id="id_last_name">
                <label for="id_gender_0">Gender:</label>
                {% for value, display in form.fields.gender.choices %}
                    <label for="id_gender_{{ value }}">
                        <input type="radio" name="gender" value="{{ value }}" id="id_gender_{{ value }}"
                               {% if form.gender.value == value %}checked{% endif %} required="">
                        {{ display }}</label>
                {% endfor %}


                <label for="id_birth_date">Birth date:</label><input type="date" name="birth_date"
                                                                     value="{{ form.birth_date.initial|date:'Y-m-d' }}"
                                                                     class="form-control" placeholder="Select a date"
                                                                     required="" id="id_birth_date">
            </div>
        </section>

        <section>
            <h3>Contact Information</h3>
            <div class="detail-row">
                <div class="detail">
                    <label for="id_email">Email address:</label> <input type="email" name="email" maxlength="254"
                                                                        value="{{ userForm.email.initial }}"
                                                                        id="id_email">
                </div>
                <div class="detail">
                    <label for="id_phone_number">Phone number:</label> <input type="text" name="phone_number"
                                                                              value="{{ form.phone_number.initial }}
                                                                              maxlength=" 256" id="id_phone_number">
                </div>
                <div class="detail">
                    <label for="id_permanent_address">Permanent address:</label> <input type="text"
                                                                                        name="permanent_address"
                                                                                        value="{{ form.permanent_address.initial }}"
                                                                                        maxlength="256"
                                                                                        required=""
                                                                                        id="id_permanent_address">
                </div>
                <div class="detail">
                    <label for="id_current_address">Current address:</label> <input type="text" name="current_address"
                                                                                    value="{{ form.current_address.initial }}"
                                                                                    maxlength="256"
                                                                                    required="" id="id_current_address">
                </div>
            </div>
        </section>

        <section>
            <h3>Bank Information</h3>
            <div class="detail-row">
                <div class="detail">
                    <label for="id_bank_name">Bank name:</label> <input type="text" name="bank_name"
                                                                        value="{{ form.bank_name.initial }}"
                                                                        maxlength="256" required="" id="id_bank_name">
                </div>
                <div class="detail">
                    <label for="id_bank_iban">Bank iban:</label> <input type="text" name="bank_iban"
                                                                        value="{{ form.bank_iban.initial }}"
                                                                        maxlength="256" required="" id="id_bank_iban">
                </div>
                <div class="detail">
                    <label for="id_bank_swift_code">Bank swift code:</label> <input type="text" name="bank_swift_code"
                                                                                    value="{{ form.bank_swift_code.initial }}"
                                                                                    maxlength="256"
                                                                                    required="" id="id_bank_swift_code">
                </div>
                <div class="detail">
                    <label for="id_bank_account_name">Bank account name:</label> <input type="text"
                                                                                        name="bank_account_name"
                                                                                        value="{{ form.bank_account_name.initial }}"
                                                                                        maxlength="256"
                                                                                        required=""
                                                                                        id="id_bank_account_name">
                </div>
                <div class="detail">
                    <label for="id_bank_address">Bank address:</label> <input type="text" name="bank_address"
                                                                              value="{{ form.bank_address.initial }}"
                                                                              maxlength="256" required=""
                                                                              id="id_bank_address">
                </div>
            </div>
        </section>

        <section>
            <h3>Language Information</h3>
            <div class="detail-row">
                <div class="detail">
                    {% for value, display in form.fields.proficiency.choices %}
                        <label for="id_proficiency_{{ value }}">
                            <input type="radio" name="proficiency" value="{{ value }}" id="id_proficiency_{{ value }}"
                                   {% if form.proficiency.value == value %}checked{% endif %} required="">
                            {{ display }}</label>
                    {% endfor %}

                </div>
                <div class="detail">
                    <label for="id_topik_score">Topik score:</label>
                    <select name="topik_score" id="id_topik_score">
                        {% for value, display in form.fields.topik_score.choices %}
                            <option value="{{ value }}"{% if form.topik_score.initial == value %}
                                    selected{% endif %}>{{ display }}</option>
                        {% endfor %}

                    </select>
                </div>
                <div class="detail">
                    <label for="id_level">Level:</label> <select name="level" id="id_level">
                    {% for value, display in form.fields.level.choices %}
                        <option value="{{ value }}"{% if form.level.initial == value %}
                                selected{% endif %}>{{ display }}</option>
                    {% endfor %}

                </select>
                </div>
                <div class="detail">
                    <label for="id_learning_period">Learning period:</label> <input type="number" name="learning_period"
                                                                                    value="{{ form.learning_period.initial }}" required=""
                                                                                    id="id_learning_period">
                </div>
                <div class="detail">
                    <label for="id_learning_method">Learning method:</label> <input type="text" name="learning_method"
                                                                                    value="{{ form.learning_method.initial }}" maxlength="256"
                                                                                    required="" id="id_learning_method">
                </div>
                <div class="detail">
                    <label for="id_study_purpose">Study purpose:</label> <input type="text" name="study_purpose"
                                                                                value="{{ form.study_purpose.initial }}" maxlength="256" required=""
                                                                                id="id_study_purpose">
                </div>
            </div>
        </section>

        <section>
            <h3>Additional Information</h3>
            <div class="detail-row">
                <div class="detail">
                    <label for="id_nationality">Nationality: {{ form.fields.nationality.value }}</label>
                    <select name="nationality" id="id_nationality">
                        {% for value, display in form.fields.nationality.choices %}
                            <option value="{{ value }}"{% if form.nationality.initial == value %}
                                    selected{% endif %}>{{ display }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="detail">
                    <label for="id_language">Language:</label>
                    <select name="language" id="id_language">
                        {% for value, display in form.fields.language.choices %}
                            <option value="{{ value }}"{% if form.language.initial == value %}
                                    selected{% endif %}>{{ display }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="detail">
                    <label for="id_education_level">Education level:</label> <select name="education_level"
                                                                                     id="id_education_level">
                    {% for value, display in form.fields.education_level.choices %}
                        <option value="{{ value }}"{% if form.education_level.initial == value %}
                                selected{% endif %}>{{ display }}</option>
                    {% endfor %}

                </select>
                </div>
                <div class="detail">
                    <label for="id_korea_residency">Korea residency:</label> <input type="number" name="korea_residency"
                                                                                    value="{{ form.korea_residency.initial }}" required=""
                                                                                    id="id_korea_residency">
                </div>
            </div>
        </section>
        <button type="submit" class="btn btn-dark">Save</button>
        <button type="button" class="btn btn-dark" id="cancel-edit">Cancel</button>
    </section>
</form>

<script>
    $('#cancel-edit').on('click', function (e) {
        $('.profile-edit-section').remove();
        $('.profile-section').removeClass('d-none');
        $('#edit-profile-btn').removeClass('d-none');
    });

    $('form').on('submit', function (e) {
        e.preventDefault();
        $.ajax({
            url: $(this).attr('action'),
            method: $(this).attr('method'),
            data: $(this).serialize(),
            success: function (e) {
                console.log('success')
                location.reload();
            },
            error: function (err) {
                console.log(err);
                $('.profile-section-container').empty().append(err.responseText);
            }
        })
    });
</script>